%-----------------------------
\chapter{ブランド選択モデルへの GNL モデルの適用}
\def\thesection{\thechapter.\arabic{section}}
\setcounter{section}{0} 
%-----------------------------
\section{4 章の目的}\label{sec:4-1}
近年のIT技術の進歩により，顧客の購買履歴や消費者行動に関するデータの入手が容易になっている．
そして，これらのデータを分析し，市場ニーズにあった商品を開発することが重要となっている．
しかし，実際の市場において消費者が商品を購買する過程においては，商品の類似性が存在する．

商品の類似性による影響としては，ある商品が売り切れた場合，その商品により類似した商品の購買回数が増加するといったものが挙げられる．
マーケッティング・サイエンスにおいては，入れ子構造を仮定しモデル構築される場合が多い (Louviere and Woodworth, 1983 \cite{LW83}; Kannan and Wright, 1991 \cite{KW91}; Bodapati, 1996 \cite{Bod96}, Kwak, 2007 \cite{Kwa07})．
これらのモデルは全て NL モデルであり，モデル内では消費者はいくつかの階層を踏んで商品を選択するとし，
上位階層における効用の説明変数に下位階層の統合値であるカテゴリー・バリュー (ログサム) が用いられる．
例えば，紙パック牛乳の選択行動では，まず，ブランドを選択し，次に個別商品を選択するといったモデルが考えられる．
しかし，紙パック牛乳には，ブランド以外にも成分 (成分無調整，低脂肪)，容量といった属性が存在し，
これらの属性による構造化 (ネスティング) も考えられる．
つまり，単なるブランド選択レベルではなく，多くの属性を有する SKU レベルの商品選択モデルでは多属性による構造化が必要となる．
しかし，通常の NL モデルでは個別の選択肢は複数の上位階層に帰属することはできない．
NL モデルを拡張し，複数の上位階層への帰属を可能とすることはモデルの精緻化，市場構造の把握，ひいては需要予測において有用である．

そこで，本章では GNL モデルを用い，ブランド選択モデルを構築する．
GNL モデルは，その多くが交通計画分野において適用されている．
ここでは，目的にあわせ，様々な具体的な構造：ネスティング・ルールが提案されている．
しかし，数少ないマーケティング分野における研究\cite{BST97,VK05}では，その明示的なルールが示されいない．

本研究では，2 つのネスティング・ルールを提案する．
このネスティング・ルールを実際に適用することにより，
日本の市場は，その商品ラインナップの多さから稀有な市場（例えば Lindstrom, 2008 \cite{Lin08}）といわれており，
商品が多くの属性を持つことが多く，GNL モデルを適用する機会は多いといえる． 

本論文の構成は以下のとおりである．
まず，\ref{sec:4-2}節では，既存の GNL モデルのネスティング・ルールについてレビューを行なう．
次に\ref{sec:4-3}節では提案するネスティング・ルールを示す．
そして，\ref{sec:4-4}節では，\ref{sec:4-3}節で提案されたネスティング・ルールを実際のデータに適用し，パラメータ推定を行なう．
また， MNL,，NL，計四つのモデルと GNL モデルを比較，検証し，感度分析を行なう．
最後に，\ref{sec:4-5}章において本章のまとめを述べる．

%***************************************************************************************************************************
\section{既存の GNL モデルのネスティング・ルール}\label{sec:4-2}
交通計画分野における GNL/CNL モデルの適用例として，表\ref{tb:4-1} が挙げられる．
ここでは，いくつかのネスティング・ルールが提案，実施・検証されている．

Vovsha (1997) \cite{Vov97}， Wen and Koppelman (2001) \cite{WK01}，溝上 (2003) \cite{Miz03} は複数の交通機関の乗り継ぎが考えられる際の交通機関選択を対象としている．
ここでは，ある単一の交通機関（バス，鉄道，飛行機）がネストに配置され，それの組み合わせにより実現される交通機関の乗り継ぎが選択肢となる．
例えば，世田谷区に在住の人が大阪の難波までのトリップを考えよう．まず，リムジンバスで羽田空港まで向かい，飛行機で大阪伊丹空港まで飛び，そのあと地下鉄で難波まで向かったとする．
この選択肢（経路）は，バス，飛行機，鉄道を利用しているため，この選択肢とこれらのネスト（単一交通機関）の間にアロケーション・パラメータが設定される．
同様に，Vovsha and Bekhor (1998) \cite{VB98} は，道路交通における経路選択に GNL モデルを応用している．
ここでは，ある経路を選択肢とし，その経路を構成するリンクをネストとする．
例えば，図\ref{fig:4-1} 左図のような Braess ネットワーク\cite{Fra81}を考えた場合の経路のネスティングは右図のようになる．
例えば，リンク A, C, E で構成されるルート$1$ は，A, C, E の三つのネストに所属する形となる．
最後に， Koppelman and Sethi (2005) \cite{KS05} では，消費者がある潜在的なクラスに属するものとし，
交通機関を選択するとしている．
ここでは，ある潜在クラスがネストに配置され，選択肢として交通機関がある．
この潜在クラスにより，確率項が，ある種歪んだ構造を持ち，この歪みにより消費者の異質な反応を表現している．
いずれも，明確なネスティング・ルールが存在する．

\begin{table}[t!]
\begin{center}
\caption{交通計画分野における GNL/CNL モデルのネスティング・ルール} \label{tb:4-1}
\begin{tabular}{lcccc}
\toprule
Article& Nest & Alternative & Target\\
\hline\hline
Vovsha (1997) \cite{Vov97}& single mode & mode (with transit)&intra-city\\
Vovsha and Bekhor (1998) \cite{VB98}&traffic link&road route&intra-city road\\
Wen and Koppelman (2001) \cite{WK01}&single mode&mode (with transit)&inter-city\\
溝上 (2003) \cite{Miz03}&single mode&mode (with transit)&intra-city\\
Koppelman and Sethi (2005) \cite{KS05}&latent class&mode&inter-city\\
\bottomrule
\end{tabular}
\end{center}
\end{table}
\begin{figure}[t]
  \centering
  \psbox[width=0.80 \linewidth]{clip4-1}
\caption{Vovsha and Bekhor (1998) \cite{VB98} におけるネスティング・ルール}
\label{fig:4-1}
\end{figure}
マーケティング・サイエンスにおいても，表\ref{tb:4-2} に示すように，少ないながら GNL/CNL モデルが適用されている．
しかし，明確なネスティング・ルールが存在する交通計画分野に対し，マーケティング・サイエンスでは明確ではない．
Bresnahan et al. (1997) \cite{BST97} はパソコンの購買に CNL モデルを適用している．
ただし，ネストは各時期に最新か否か，もしくはブランドかノンブランドの $4$ つとしており，理由は詳しくは書かれていない．
Venkataraman and Kadiyali (2005) \cite{VK05} に至ってはネストの意味を全く述べていない．
つまり，マーケティング・サイエンスにおいては，GNL/CNL モデルのネスティング・ルールは確立されていないといえる．

\begin{table}[t]
\begin{center}
\caption{マーケティング・サイエンスにおける GNL/CNL モデルのネスティング・ルール} \label{tb:4-2}
\begin{tabular}{lcccc}
\toprule
Article& Nest & Alternative & Target\\
\hline\hline 
Bresnahan et al. & the newest model or not,& \multirow{2}{*}{single product}&\multirow{2}{*}{personal computer}\\
(1997)\cite{BST97} &  and branded or not & & \\
Venkataraman and &\multirow{2}{*}{obscurity} & \multirow{2}{*}{single lodge}&\multirow{2}{*}{lodge}\\
Kadiyali (2005) \cite{VK05} & & \\
\bottomrule
\end{tabular}
\end{center}
\end{table}
%***************************************************************************************************************************
\section{提案するネスティング・ルール}\label{sec:4-3}
本節では，マーケティング・サイエンスにおける代表的なモデルである，ブランド選択モデルへの適用を考えた GNL/CNL のネスティング・ルールを提案する．
具体的には，属性分割 （Attribute Separation） と消費者潜在クラス（Consumer Latent Class) である．

前者は，商品の持つ属性に着目し，それをネストに配置するものである．
交通計画分野の Vovsha and Bekhor (1998) \cite{VB98} のネスティング・ルールをマーケティング・サイエンスとして捉えたものと解釈できる．
具体的には，次の手順で構造が決定される：
\begin{enumerate}
\item カテゴリー内の商品の属性を列挙する，
\item その属性を（〜がないというのを含め）ネストとして平行に並べる，
\item 商品を選択肢として並べ，ある属性とその属性を持つ商品をアロケーション・パラメータで接続．
\end{enumerate}
この手法は，パソコン等の多くの属性を持つカテゴリーに有効であると考えられる．
本章で，ペットボトル・コーラへと適用し，その妥当性を検証する．

後者は，消費者の異質性に着目し，消費者が潜在的なクラスに属するものと仮定するものである．
各クラスは，原則全ての商品との間をアロケーション・パラメータで接続する．
交通計画分野の Koppelman and Sethi (2005) \cite{KS05} のネスティング・ルールをマーケティング・サイエンスに応用したものである．
5 章で GNL モデルを拡張したものに適用し，6 章でも心理的効果を表現するのに用いる．
%***************************************************************************************************************************
\section{ パラメータ推定方法}\label{sec:4-4}
GNL モデルのパラメータ推定は最尤推定により行われるのが一般的である．
3 章で示したように，最尤推定にも段階推定と同時推定があるが，本章では，同時推定を採用する．

同時推定時の GNL モデルの尤度関数 $L$ は次のとおり書ける：
\begin{align}
L(\bm{\theta} )&= \prod_{h^{\prime}=1}^{N_h} \prod_{j^{\prime}=1}^{N_j} \prod_{k^{\prime} \in{{\cal K}_{j^{\prime}}}} \left\{ P_{k^{\prime}|j^{\prime}} (\bm{\theta} ) P_{j^{\prime}} (\bm{\theta} ) \right\}^{\delta_{j^{\prime},k^{\prime}}^{h^{\prime}}}.\label{eq4-1}
\end{align}
ここで，$\bm{\theta}$ はモデルのパラメータの集合，$N_h$ は購買機会数（サンプル数） そして，
$\delta_{j,k}^h$ は消費者 $h$ が属性 $j$ によりブランド（商品） $k$ を選択した場合 $1$ ,しない場合 $0$ となる変数である．
式\eqref{eq4-1} の対数をとると，対数尤度関数
\begin{align}
{\cal L}(\bm{\theta} ) := \ln (L (\bm{\theta} )) = \sum^{N_h}_{h^{\prime}=1} \sum_{j^{\prime}=1}^{N_j} \sum_{k^{\prime} \in{{\cal K}_{j^{\prime}}}} \delta_{j^{\prime},k^{\prime}}^{h^{\prime}} \ln P_{k^{\prime}|j^{\prime}}^{h^{\prime}} (\bm{\theta} ) P_{j^{\prime}}^{h^{\prime}} (\bm{\theta} ).\label{eq4-2}
\end{align}
が導かれる．
この対数尤度を最大化するように，パラメータを推定する．ただし，一般的な NL モデルは階層別に段階推定が可能であるが，
本モデルでは，潜在クラス及びサブクラスの選択結果が直接観測できないため，すべてのパラメータを同時推定する必要がある．

この種のモデルでは，同一データより異なるパラメータが推定される可能性がある (Marzano and Papola, 2008 \cite{MP08})．
そこで，本研究では，NL モデルで一旦パラメータ推定を行ない，そのパラメータを初期値として LGNL モデルのパラメータ推定を行なう．
ただし，Marzano and Papola (2008) \cite{MP08} は，一般的な初期値依存問題を述べているのではなく，同じ相関構造を持つまったく異なるパラメータ・セットが存在することを指摘している．
この現象は最小二乗法により小数のデータより回帰係数を求める際に最尤推定量が一意に求まらない場合とは異なり，
ニューラル・ネットワークの構造推定等と同様の，同程度の対数尤度がまったく異なるパラメータ・セットより推定される可能性を示唆している．
交通計画分野において，Zhuang et al. (2007) \cite{ZFY07} はこの問題点が実際の問題として生起していることを示している．
これを極力回避するために，GNL モデルに内包される NL モデルでまずパラメータ推定を行ない，類似度パラメータの大きさを確認し，
それを初期値（初期値は潜在クラス数に依存し，単純に各 NL モデルが一意に収束した場合には（後に示す検証では $3$つ，一意に収束しない場合にはそれ以上）とし，類似度パラメータの大きさが大幅にずれないように，パラメータ推定を行なう．
%***************************************************************************************************************************
\section{適用}\label{sec:4-5}
%***************************************************************************************************************************
\subsection{ 対象データ}
本研究では，同一スーパー・チェーン 2 店舗で 2001 年年間に販売されているペットボトル・コーラのスキャン・パネル・データを用い，パラメータの推定を行なう．
データ詳細を表\ref{tb:4-3} に示す．
データの対象商品数は全 $9$ 商品のうち購買機会 $100$ 回以上である表に示す $8$ 種類とする．
全サンプル数は $903$ 世帯，$5,269$ 購買機会であり，約 $2/3$ に相当する$545$ 世帯，$3,505$ 購買機会を推定用サンプルとし，残り約 $1/3$ に相当する $458$ 世帯，$1,764$ 購買機会を検証用サンプルとする．
\begin{table}[t]
\begin{center}
\caption{推定，検証用データ概要} \label{tb:4-3}
\begin{tabular}{lrcrrrc}
\toprule
\multirow{2}{*}{Name} & \multirow{2}{*}{ $\#$ of purchase} & Employ& \multicolumn{3}{c}{Portion (\%)} & \multirow{2}{*}{ $k$ } \\
                                 &                                        &or not&\multirow{1}{*}{Estimation}&\multirow{1}{*}{Verification}&\multirow{1}{*}{Total}& \\\hline\hline
Coca-Cola $1.5l$ & $1,605$ & employ & $29.5$ & $32.5$ & $30.5$ &$1$ \\
Coca-Cola $500ml$ & $506$ & employ & $9.6$ & $9.9$ & $9.6$ & $2$ \\
Diet Coke $1.5l$ & $707$ & employ & $13.8$ & $12.6$ & $13.4$ & $3$ \\
Diet Coke $500ml$ & $180$ & employ & $3.6$ & $3.0$ & $3.4$ & $4$ \\
Pepsi $1.5l$& $1,024$ & employ & $18.8$ & $20.8$ & $19.4$ & $5$ \\
Pepsi $500ml$ & $525$ & employ & $10.1$ & $9.7$ & $10.0$ & $6$ \\
Diet Pepsi $1.5l$ & $611$ & employ & $12.1$ & $10.5$ & $11.6$ & $7$ \\
Diet Pepsi $500ml$ & $111$ & employ & $2.2$ & $2.0$ & $2.1$ & $8$ \\
US Coke $500ml$ & $75$ & & -- & -- & -- & -- \\
\bottomrule
\end{tabular}
\end{center}
\end{table}
%***************************************************************************************************************************
\subsection{モデルの同定}
選択肢の効用関数は，以下に示す変数を用い，一般的な線形とする：
\begin{equation}
V_{k}^h=\alpha_{1} X_{1k}+\alpha_{2} X_{2k}+\alpha_{3} X_{3k}+\alpha_{4} X_{4k}+\alpha_{5} X_{5k}~~\forall k. \label{eq4-3}
\end{equation}
ここで $X_{1k}$ は商品 $k$ の価格（円），$X_{2k}$ はコカコーラ・ダミー（コカコーラ $=1$），$X_{3k}$ は容量 ($ml$)，$X_{4k}$ はノンシュガー・ダミー（ノンシュガー $=1$），
$X_{5k}$ は前回購買商品ダミー（前回購買商品 $=1$）である．なお，初期購買時においては，すべての商品を $X_{5k}=1$ と設定する．

ネスティング・ルールとして属性分割を用いる．
ネストは，ブランド：コカ・コーラ（$j=1$），ブランド：ペプシ（$j=2$），容量：$1.5l$（$j=3$），容量：$500ml$（$j=4$），内容：通常（$j=1$），内容：低糖，無糖（$j=2$）の 6 つを仮定する．
以上より，具体的な選択ツリーは図\ref{fig:4-2}に示すとおりとなる．
\begin{figure}[t]
  \centering
  \psbox[width=0.80 \linewidth]{clip4-2}
\caption{属性分割による GNL モデルの構造 (ペットボトル・コーラ)}
\label{fig:4-2}
\end{figure}
%***************************************************************************************************************************
\subsection{ 比較，検証}
商品属性の類似性（構造異質性）の有無によるモデル適合度を比較するため，類似性をまったく仮定しないモデル [MNL]，
ブランドによる類似性のみを考慮したモデル [NL1]，量による類似性のみを考慮したモデル [NL2]，内容の違い（低糖，無糖か否か）による類似性を考慮したモデル [NL3]，
そして $3$ つ全てを考慮するモデル [GNL] の$5$ つのモデルを比較することとする．
%***************************************************************************************************************************
\subsubsection{統計量の比較}
$5$ つのモデルの統計量の比較を表\ref{tb:4-4}に示す．全ての属性の類似性を考慮している [GNL] は，$\bar\rho^2 $ が $0.2199$ と$0.2$を上回る値を示しており，十分な再現性を有しているといえる．
$5$ つのモデルの比較においても，対数尤度，AIC，BIC，的中率すべてにおいて，[GNL] がまさっており，
全ての属性の類似性を考慮することが再現性を向上しているといえる．
また，[NL1]，[NL2]，[NL3] を比較した場合，一番統計量の面から優れているのは [NL3] である．
このことから，消費者は一番内容の違いを気にしており，次にブランド，最後に容量といえる．
ただし，NL モデルの全ての統計量は，MNL モデルとの差は小さいため，全ての類似性を考える意味は大きいといえる．
このような結果となった理由としては，データ取得場所が大手スーパーであるため，特売日のまとめ買い等，
我々が買ってすぐに飲むという場合と比較し，ブランドによる類似性は過小に見積もられ，内容に焦点があたった点が挙げられる．
本研究で対象としてスーパーではなく，コンビニエンス・ストア等ではまた違う結果が出る可能性がある．
\begin{table}
\begin{center}
\caption{統計量の比較}  \label{tb:4-4}
\begin{tabular}{crrrrr} \toprule
\multicolumn{1}{c}{}&\multicolumn{1}{c}{[MNL]}&\multicolumn{1}{c}{[NL1]}&\multicolumn{1}{c}{[NL2]}&\multicolumn{1}{c}{[NL3]}&\multicolumn{1}{c}{[GNL]}\\\hline\hline
$\cal L$ &$-3,006$&$-2,994$&$-2,998$&$-2,915$&$-2,842$\\
AIC&$6,022$&$6,003$&$6,010$&$5,845$&$5,734$\\
$\bar\rho^2$&$0.1781$&$0.1806$&$0.1797$&$0.2021$&$0.2199$\\
Hit Ratio&$0.4042$&$0.4070$&$0.4031$&$0.4105$&$0.4184$\\\bottomrule
\end{tabular}
\end{center}
\end{table}
%***************************************************************************************************************************
\subsubsection{パラメータの比較}
$5$ つのモデルの主要パラメータを表\ref{tb:4-5} に示す．また，効用関数パラメータを金銭換算したものを表\ref{tb:4-6} に示す．

表\ref{tb:4-5} より，各モデルの効用関数パラメータは概ね $99\%$ で統計的有意といえる．
ただし，MNL モデルでは，ノンシュガー・ダミーが有意となっていない．
また，モデル間でブランド・ダミーとノンシュガー・ダミーにモデル間で特に大きな差が存在していることがわかる．
これは MNL，NL モデルにおいてネスティングされない属性が確定的効用関数の値に大きな影響を及ぼしていると考えられる．

表\ref{tb:4-6} は，価格に関するパラメータ $\alpha_1$ で各パラメータを除すことで，各パラメータを金銭換算している．
一番統計量の比較において優れている GNL モデルの値を真とするならば，単位あたり容量については，MNL，NL の各モデルは過小評価，
内容ダミーについては，MNL モデルは過小評価，NL の各モデルは過大評価していることとなる．
これは，集計量の比較において大きな差となって現れる．

表\ref{tb:4-7} は，検証用データの集計量の比較結果を示している．
この集計量は所謂マーケット・シェアであり，実務において最もモデルの適合度を判断するのに使われる．
各統計量が劣っている，[MNL]，[NL2]，[NL1]，[NL3]，[GNL]の順に最小二乗誤差($MSE$)が小さくなっていることがわかる．
特に [GNL] は他のモデルと比較し，最小二乗誤差が $1/10$ 程度と極めて小さい．
つまり，集計量からも GNL モデルの優位性が示されたといえる．

\begin{table} [t]
\begin{center}
\caption{効用関数パラメータ}  \label{tb:4-5}
\begin{tabular} {crrrrr}
\toprule
&\multicolumn{1}{c}{[MNL]}&\multicolumn{1}{c}{[NL1]}&\multicolumn{1}{c}{[NL2]}&\multicolumn{1}{c}{[NL3]}&\multicolumn{1}{c}{[GNL]}\\
\hline
\hline
\multirow{2}{*}{$ \alpha_1 $} & $-0.020$ & $-0.020$ & $-0.017$ & $-0.016$ & $-0.011$\\
&Fixed&$\ast\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$\\\hline
\multirow{2}{*}{$ \alpha_2 $} & $0.446$ & $0.390$ & $0.304$ & $0.373$ & $0.043$\\
&$\ast\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$\\\hline
\multirow{2}{*}{$ \alpha_3 $} & $0.002$ & $0.002$ & $0.002$ & $0.001$ & $0.002$\\
&$\ast$&$\ast\ast$&$\ast$&$\ast$ &$\ast\ast$\\\hline
\multirow{2}{*}{$ \alpha_4 $} & $-0.001$ & $-0.801$ & $-0.800$ & $-1.285$ & $-0.256$\\
& &$\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$\\\hline
\multirow{2}{*}{$ \alpha_5 $} & $1.362$ & $1.197$ & $1.051$ & $1.115$ & $0.587$\\
&$\ast\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$&$\ast\ast$
\\\bottomrule
\multicolumn{6}{l}{t検定において$\ast\ast$99\%有意，$\ast$95\%有意}
\end{tabular}
\end{center}
\end{table}

\begin{table} [t]
\begin{center}
\caption{パラメータの金銭換算}  \label{tb:4-6}
\begin{tabular} {clrrrrr}
\toprule
&&[MNL]&[NL1]&[NL2]&[NL3]&[GNL]\\
\hline
\hline
{$ \alpha_2/\alpha_1 $} & {(yen)} & $22.06$ & $36.06$ & $23.41$ & $23.24$&$38.59$\\
{$ \alpha_3/\alpha_1 $} & {(yen/ml)} & $0.12$ & $0.08$ & $0.11$ & $0.05$& $0.18$ \\
{$ \alpha_4/\alpha_1 $} & {(yen)} & $-0.06$ & $-40.60$ & $-47.96$ & $-80.10$&$-23.16$  \\
{$ \alpha_5/\alpha_1 $} & {(yen)} & $67.37$ & $60.69$ & $63.04$ & $69.54$&$53.18$ \\
\bottomrule
\end{tabular}
\end{center}
\end{table}

\begin{table}
\begin{center}
\caption{集計量の比較} \label{tb:4-7}
\begin{tabular}{crrrrrr} \toprule
\multicolumn{1}{c}{}&\multicolumn{1}{c}{Actual}&\multicolumn{1}{c}{[MNL]}&\multicolumn{1}{c}{[NL1]}&\multicolumn{1}{c}{[NL2]}&\multicolumn{1}{c}{[NL3]}&\multicolumn{1}{c}{[GNL]}\\\hline\hline
$P_1^{\A}$&$32.46$&$23.34$&$24.25$&$23.88$&$25.69$&$30.35$\\
$P_2^{\A}$&$9.04$&$8.56$&$8.02$&$8.24$&$11.33$&$9.08$\\
$P_3^{\A}$&$12.62$&$18.31$&$18.69$&$18.45$&$16.13$&$14.09$\\
$P_4^{\A}$&$2.96$&$6.94$&$6.23$&$7.03$&$4.35$&$3.65$\\
$P_5^{\A}$&$20.75$&$19.14$&$18.48$&$18.8$&$21.39$&$20.25$\\
$P_6^{\A}$&$9.67$&$5.08$&$5.43$&$5.17$&$7.30$&$10.04$\\
$P_7^{\A}$&$10.52$&$14.23$&$14.04$&$13.66$&$11.57$&$10.43$\\
$P_8^{\A}$&$1.99$&$4.40$&$4.86$&$4.74$&$2.25$&$2.11$\\\hline
MSE$^{\ast}$&--&$21.85$&$19.97$&$20.77$&$9.07$&$0.94$\\\bottomrule
\multicolumn{7}{l}{$\ast$ 平均二乗誤差}
\end{tabular}
\end{center}
\end{table}
%***************************************************************************************************************************
\subsection{感度分析}
ここでは，前節までで推定されたパラメータのもと，感度分析を行なう．
具体的には，特定商品（今回は $k=1$，コカコーラ $1.5l$）を売切れとした場合，
特定商品（今回はダイエットペプシ $1.5l$，$500ml$）に価格プロモーションを行なった場合の選択確率の変化を，モデル間で比較する．
%***************************************************************************************************************************
\subsubsection{特定商品を売切れとした場合の選択確率の比較}
本小節では，特定商品（今回は $k=1$，コカコーラ $1.5l$）を売切れとし，消費者がすべて代替商品を購買するという仮定のもと，選択確率の変化をモデル間で比較する．
ただし，価格その他の値については，パラメータ推定時と同様とする．
通常時の各商品の選択割合，売切れ時，そしてその差について表\ref{tb:4-8}に示す．

$k=1$ の商品は購入割合も大きいため，売切れ時の割合の変動も大きい．
モデル間で比較した場合，$k=4$，$k=5$ の値のばらつきが大きくなっている．これは，属性の類似性を考慮したかしないか，そしてその大きさに依存するものと考えられる．
$k=4$ はブランドが $k=1,2$ と同じであり，容量も $k=2$ と同じである．
同様に $k=5$ は $k=1$ と容量，内容が同じである．
このように商品属性の類似性を考慮することにより，大きく予測結果が異なることがわかる．
%***************************************************************************************************************************
\subsubsection{特定商品価格プロモーション時の選択確率の比較}
本小節では，特定商品（今回はダイエットペプシ $2$ 商品 $k=7,8$）について，価格を表示価格の $30\%$ 引きとした場合の選択確率の変化をモデル間で比較する．
通常時，プロモーション時，その差について表\ref{tb:4-9}に示す．

モデル間で比較した場合，$k=5$，$k=8$ の値のばらつきが大きくなっている．これも売切れ時と同様に，属性の類似性を考慮したかしないか，そしてその大きさに依存するものと考えられる．
$k=5$ はブランドが $k=7,8$ と同じであり，容量も $k=7$ と同じである．
同様に $k=8$ は $k=7$ とブランド，内容が同じである．
一般的に商品 $k=7$ の方が $k=8$ より魅力的であり，GNL モデルではこの間に複数の類似性を考慮することにより，$k=7$ の選択割合がさらに伸び，その分 $k=8$ は伸び悩んだと考えられる．
このように商品属性の類似性を考慮することにより，大きく予測結果が異なることがわかる．

{\tabcolsep = 1.0mm
\begin{table} [b]
\begin{center}
\caption{商品売切れ時の選択割合の比較}  \label{tb:4-8}
\begin{tabular} {c rrrrr rrrrr rrrrr}
\toprule
$P_k^{\A}$& \multicolumn{5}{c}{Normal{($\%$)}}  & \multicolumn{5}{c}{Sell out($\%$) } & \multicolumn{5}{c}{Difference (point)} \\
&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}\\
\hline
\hline
$P_1^{\A}$& $23.3$ &$24.3$&$23.9$&$25.7$&$30.4$ &$0.00$&$0.00$&$0.00$&$0.00$&$0.00$    & $-23.3$ &$-24.3$&$-23.9$&$-25.7$&$-30.4$\\
$P_2^{\A}$& $8.6$ &$8.0$&$8.2$&$11.3$&$9.1$       &$0.00$&$0.00$&$0.00$&$0.00$&$0.00$     & $-8.6$ &$-8.0$&$-8.2$&$-11.3$&$-9.1$\\
$P_3^{\A}$& $18.3$ &$18.7$&$18.5$&$16.1$&$14.1$ &$27.1$&$30.6$&$28.3$&$25.8$&$26.1$    &$8.8$&$11.9$&$9.9$&$9.7$&$12.0$\\
$P_4^{\A}$& $6.9$ &$6.2$&$7.0$&$4.3$&$3.6$         &$10.5$&$10.5$&$9.8$&$7.1$&$6.4$         &$3.5$&$4.3$&$2.7$&$2.8$&$2.8$\\
$P_5^{\A}$& $19.1$ &$18.5$&$18.8$&$21.4$&$20.3$ &$27.3$&$25.0$&$27.5$&$33.3$&$34.2$    &$8.1$&$6.5$&$8.6$&$11.9$&$14.0$\\
$P_6^{\A}$& $5.1$ &$5.4$&$5.2$&$7.3$&$10.0$        &$7.5$&$7.6$&$7.1$&$11.8$&$13.5$       &$2.5$&$2.1$&$2.0$&$4.5$&$3.4$\\
$P_7^{\A}$& $14.2$ &$14.0$&$13.7$&$11.6$&$10.4$ &$20.9$&$19.5$&$20.7$&$18.3$&$16.5$     &$6.6$&$5.4$&$7.0$&$6.8$&$6.1$\\
$P_8^{\A}$& $4.4$ &$4.9$&$4.7$&$2.2$&$2.1$         &$6.7$&$6.9$&$6.6$&$3.7$&$3.3$             &$2.3$&$2.1$&$1.9$&$1.5$&$1.2$\\
\bottomrule
\end{tabular}
\end{center}
\end{table}
}
{\tabcolsep = 1.0mm
\begin{table} [b]
\begin{center}
\caption{価格プロモーション時の選択割合の比較}  \label{tb:4-9}
\begin{tabular} {c rrrrr rrrrr rrrrr}
\toprule
$P_k^{\A}$& \multicolumn{5}{c}{Normal{($\%$)}}  & \multicolumn{5}{c}{Under promotion($\%$) } & \multicolumn{5}{c}{Difference (point)} \\
&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}&\tiny{[MNL]}&\tiny{[NL1]}&\tiny{[NL2]}&\tiny{[NL3]}&\tiny{[GNL]}\\
\hline
\hline
$P_1^{\A}$& $23.3$ &$24.3$&$23.9$&$25.7$&$30.4$ &$18.6$&$19.4$&$18.3$&$22.1$&$24.8$    & $-4.7$ &$-4.8$&$-5.6$&$-3.5$&$-5.6$\\
$P_2^{\A}$& $8.6$ &$8.0$&$8.2$&$11.3$&$9.1$       &$6.7$&$6.3$&$6.7$&$9.7$&$7.9$     & $-1.9$ &$-1.7$&$-1.5$&$-1.7$&$-1.1$\\
$P_3^{\A}$& $18.3$ &$18.7$&$18.5$&$16.1$&$14.1$ &$14.4$&$14.8$&$13.9$&$11.1$&$8.0$    &$-3.8$&$-3.9$&$-4.6$&$-5.0$&$-6.1$\\
$P_4^{\A}$& $6.9$ &$6.2$&$7.0$&$4.3$&$3.6$         &$5.4$&$4.9$&$5.7$&$28.5$&$2.7$         &$-1.5$&$-1.4$&$-1.3$&$-1.5$&$-0.9$\\
$P_5^{\A}$& $19.1$ &$18.5$&$18.8$&$21.4$&$20.3$ &$15.3$&$14.7$&$14.4$&$18.5$&$14.3$    &$-3.8$&$-3.7$&$-4.4$&$-2.9$&$-5.9$\\
$P_6^{\A}$& $5.1$ &$5.4$&$5.2$&$7.3$&$10.0$        &$39.5$&$4.2$&$4.2$&$6.2$&$8.9$       &$-1.1$&$-1.2$&$-1.0$&$-1.1$&$-1.1$\\
$P_7^{\A}$& $14.2$ &$14.0$&$13.7$&$11.6$&$10.4$ &$29.0$&$28.5$&$30.2$&$26.0$&$27.2$     &$14.8$&$14.5$&$16.5$&$14.5$&$16.8$\\
$P_8^{\A}$& $4.4$ &$4.9$&$4.7$&$2.2$&$2.1$         &$6.6$&$7.2$&$6.6$&$3.5$&$6.1$             &$2.2$&$2.3$&$1.8$&$1.2$&$4.0$\\
\bottomrule
\end{tabular}
\end{center}
\end{table}
}
%***************************************************************************************************************************
\section{4 章のまとめ}\label{sec:4-6}
%***************************************************************************************************************************
本章では，今まで明確に定義されることのなかった，マーケティング分野における GNL モデルのネスティング・ルールについて，
1) 商品異質性を捉える：属性分割，2) 消費者の異質性を捉える：潜在クラス の２つを提案した．
そして，属性分割について，実際の POS データに適用し，既存の MNL，NL モデルと比較することでその有効性を検証した．

検証の結果，対数尤度，AIC，BIC，McFaddenの自由度調整済 $\rho^2$ いずれの統計量も MNL，NL モデルと比較し，GNL モデルが優れていることがわかった．
また，効用関数のパラメータが MNL，NL，GNL の各モデル間で大きく異なることがわかった．
仮に GNL モデルのパラメータが真だとするならば，MNL，NL の各モデルは，需要予測等において大きな誤差を生む可能性がある．
これは，検証用データにおける集計量の誤差にも現れている．
集計された選択確率，すなわちマーケット・シェアの誤差は，GNL モデルが小さく，他のモデルの $1/10$ 程度であった．
これらの事実から，既存の MNL，NL モデルと比較し，GNL モデルをブランド選択モデルに適用することは有効であるといえる．

今後の課題としては，より多くの属性をもった商品カテゴリー，例えばパソコンへの適用が挙げられる．
このような場合，アロケーション・パラメータの数が膨大となる恐れがあり，構造化が必要となるだろう． 


