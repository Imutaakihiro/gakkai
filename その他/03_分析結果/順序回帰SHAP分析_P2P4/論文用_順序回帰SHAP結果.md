# 論文用：順序回帰モデル SHAP 分析の結果と考察

**目的**: 卒論・学会論文にそのまま貼りやすい形で「結果」「考察」「図表のキャプション」をまとめたもの。  
**データ**: 順序回帰SHAP分析_P2P4 フォルダ内の CSV・PNG・既存メモを基に作成。

---

## 1. 論文に書く「方法の1文」（参照用）

> 授業評価の順序回帰モデル（CORAL型・LLP損失）に対し、自由記述テキストを入力としたときの予測（P2：中低評価確率、P4：高評価確率）について、SHAP（Lundberg & Lee, 2017）により語単位の重要度を算出した。背景サンプル1,000件、語彙数7,795語を対象とした。

---

## 2. 結果（そのままコピペして使える段落）

### 2.1 分析の概要

順序回帰モデルの出力のうち、**P2（中低評価確率）** と **P4（高評価確率）** に対してSHAP分析を実施した。各語のSHAP重要度の絶対値で順位づけし、P2・P4で「強い共通要因」「P2特化要因」「P4特化要因」に分類した。その結果、**P2特化要因が1,069語**、**強い共通要因が2語**（「高圧」「圏」）であった。P4特化要因は0件であり、高評価確率を高める語は中低評価確率を下げる語と重なるか、重要度が全体的に低かった。

### 2.2 P2（中低評価確率）に寄与する語

P2へのSHAP重要度が**正**である語は、「その語が含まれる記述ほど2点寄り（中低評価）になりやすい」と解釈できる。トークン単位の上位には subword の断片が含まれるため、意味解釈可能な日本語の語に絞って整理した。

**不満・困難・否定的評価を表す語**として、苦しむ、ひど、格差、退屈、不便、下手、文句、嫌、批判、残念、難しかっ、未熟、ゴミ、消える、高圧、迷い、陥る、見つから、などが重要度の高い語に含まれた。これらは、低評価に結びつきやすい自由記述の内容と整合的である。**授業・分野を特徴づける語**（クリエイター、オブジェクト、プログラミング、ゼミ、業界、素材など）も上位に現れ、特定の授業でどのような不満が語られやすいかの手がかりとなる。**人間関係・場面**（チームメイト、パートナー、馴染み、配属）も重要度が高く、「馴染みがない」「配属が合わない」といった否定・不満の文脈での共起が考えられる。一方で、明るい、希望、楽し、優しいといったポジティブ語もP2に寄与しているように見える語があったが、「明るくない」「希望が持てない」など否定形での共起の可能性があり、解釈には生テキストの確認が望ましい。

### 2.3 P4（高評価確率）に寄与する語

P4へのSHAP重要度が正である語の最大値は約0.0005程度で、P2の上位語（約0.003〜0.008）に比べて一桁小さい。上位語には「圏」「高圧」「無」「句」「慣用」「唱」「拒否」「見下」「ヵ月」「妙」などが含まれ、単体では解釈が難しい語や、文脈依存の語が多い。「高圧」「圏」はP2・P4の両方で重要度が高く、記述の文脈によっては低評価・高評価のいずれにも関与しうる共通要因と解釈できる。P4特化要因が0件であったことから、**「4点を増やす」ために特に効く語**は、本データ・モデルでは明確に分離されなかった。目視分析（P4傾向分析_目視.md）では、中位以降に**ポジティブ・肯定文脈らしい語**（楽し、面白、楽しい、恵まれ、易い、役立っ、理想、進歩）が含まれること、**拒否・見下・偏見**は否定形での共起（「拒否感がない」等）であれば高評価と整合しうることを整理した。

### 2.4 授業改善への示唆

P2（中低評価確率）に寄与する語が、不満・困難・否定的評価と整合的であったことから、**これらの語が多く出現する記述や授業**を重点的に見直すことで、「2点を減らす」改善候補を洗い出しうる。順序回帰モデルとSHAPを組み合わせることで、**平均評価を上げる（とくに低評価を減らす）ための語レベルの手がかり**が得られることが示された。

---

## 3. 表・図のキャプション案（論文用）

### 表

- **表X** 順序回帰SHAP分析の概要（サンプル数1,000、語彙数7,795）。P2：中低評価確率、P4：高評価確率への語単位SHAP重要度を算出し、強い共通要因・P2特化・P4特化に分類した。
- **表X** P2（中低評価確率）に寄与する語の例（意味のある日本語の語に限定、重要度の高い順）。断片・subwordは除いた。
- **表X** P2・P4の強い共通要因（両方で重要度が高い語）。高圧、圏の2語。

### 図

- **図X** P2（中低評価確率）に寄与する語のSHAP重要度 Top 30。`p2_top30_factors_production.png` を参照。
- **図X** P4（高評価確率）に寄与する語のSHAP重要度 Top 30。`p4_top30_factors_production.png` を参照。
- **図X** P2・P4の重要語の比較。`p2_p4_comparison_production.png` を参照。
- **図X** 要因のカテゴリ別件数（強い共通・P2特化・P4特化など）。`factor_categories_chart_production.png` を参照。

---

## 4. 考察（論文用の短文）

- 順序回帰モデルの**クラス確率（P2・P4）**に対してSHAP分析を行うことで、「低評価を減らす要因」と「高評価を増やす要因」を語レベルで検討できることを示した。
- P2に寄与する語には、**不満・困難・否定的評価**を表す語が多く含まれ、モデルの解釈可能性と実務的な有用性が両立しうることが示唆された。
- P4に寄与する語は重要度が低く、かつ単体では解釈しにくい語が多かった。サンプル数・質問項目・授業群の偏りなどの影響が考えられ、今後のデータ拡充や、高評価記述に特化した分析が有用である。

---

## 5. 限界（論文用の短文）

- SHAP重要度は**相関**であり、因果関係を示すものではない。
- トークン単位（WordPiece）のため、同一語の複数トークンは別扱いであり、語単位で集約すると順位が変わる可能性がある。
- 背景サンプル1,000件で固定しており、サンプル変更による安定性は未検証である。
- ポジティブ語がP2に寄与しているように見える語については、否定形での共起の有無を生テキストで確認していない。

---

## 6. 論文で参照するファイル一覧

| 用途         | ファイル名 |
|--------------|------------|
| P2 重要語TOP30 の図 | `p2_top30_factors_production.png` |
| P4 重要語TOP30 の図 | `p4_top30_factors_production.png` |
| P2・P4 比較図     | `p2_p4_comparison_production.png` |
| カテゴリ別件数図   | `factor_categories_chart_production.png` |
| P2 語リスト（全語） | `word_importance_p2中低評価確率_production.csv` |
| P4 語リスト（全語） | `word_importance_p4高評価確率_production.csv` |
| P2 Top100       | `word_importance_p2_top100_production.csv` |
| P4 Top100       | `word_importance_p4_top100_production.csv` |
| 数値サマリ       | `analysis_summary_production.json` |

---

**作成日**: 2026-01-29（順序回帰SHAP分析結果・P2傾向分析・結果サマリを基に論文用に再構成）
