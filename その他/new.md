---
alwaysApply: true
---

# 順序回帰モデルの目的と予稿執筆方針

## 📊 従来のマルチタスク学習との比較

### 従来のマルチタスク学習
- **入力**: 授業の全自由記述（集団レベル）
- **タスク1**: 感情スコア平均（回帰）
- **タスク2**: 授業評価スコア（回帰、連続値、1～4の範囲）
- **課題**: 
  - 評価スコアを連続値として扱うため、順序性が考慮されていない
  - 1と4の誤りが同じ重み（順序性を無視）
  - タスク間干渉による性能低下
  - **2点がどのような要因があるか**と**4点がどのような要因があるか**を区別できない

### 順序回帰モデル（マルチタスク学習の改善版）
- **入力**: 授業の全自由記述（集団レベル）
- **タスク1**: 感情スコア平均（回帰、補助情報）
- **タスク2**: 評価スコアの確率分布（順序回帰、主目的）
  - P1: 低評価確率（スコア1）
  - P2: 中低評価確率（スコア2）
  - P3: 中高評価確率（スコア3）
  - P4: 高評価確率（スコア4）
- **期待値計算**: E[y] = 1×P1 + 2×P2 + 3×P3 + 4×P4
  - 授業評価スコアは期待値から計算（回帰ヘッド不要）

**位置づけ**: 順序回帰モデルはマルチタスク学習の一種であり、従来のマルチタスク学習の課題（順序性の無視、2点・4点の要因分離の困難）を解決した改善版である。

## 🎯 順序回帰モデルの目的

### 1. **教師の視点：平均3点の改善戦略**

**核心的な問題意識**:
- 授業評価スコアの平均は約3点である
- 教師側からしたら、**2点のものを減らして、4点のものを増やしたい**
- しかし、従来のマルチタスク学習では、**2点がどのような要因があるか**と**4点がどのような要因があるか**を区別することが困難であった

**順序回帰モデルの解決策**:
- 確率分布（P1, P2, P3, P4）を直接予測することで、各評価段階の要因を分離可能
- **P4（4点確率）への寄与** → 4点を増やす要因を特定
- **P2（2点確率）への寄与** → 2点を減らす要因を特定

### 2. **2種類の要因分離：4,3,2,1を分ける要因と4・3,2・1を分ける要因**

順序回帰モデルでは、以下の2種類の要因分離が可能：

#### 2-1. **各評価段階を分ける要因（4, 3, 2, 1の分離）**

各評価段階での要因を個別に分析：

- **P4（4点確率）への寄与**: 4点を増やす要因
  - **SHAP分析**: `analyze_ordinal_shap_production.py`で`predict_p4`関数を使用
  - **目的**: 4点評価を増やすための施策を特定
  
- **P3（3点確率）への寄与**: 3点を増やす要因
  - **SHAP分析**: `predict_p3`関数を使用
  - **目的**: 3点評価を増やすための施策を特定
  
- **P2（2点確率）への寄与**: 2点を減らす要因
  - **SHAP分析**: `predict_p2`関数を使用
  - **目的**: 2点評価を減らすための施策を特定（**教師の最重要課題**）
  
- **P1（1点確率）への寄与**: 1点を減らす要因
  - **SHAP分析**: `predict_p1`関数を使用
  - **目的**: 1点評価を減らすための施策を特定

#### 2-2. **高評価と低評価を分ける要因（4・3と2・1の分離）**

高評価と低評価の要因を分離：

- **P4・P3（高評価確率）への寄与**: 高評価（4・3）を増やす要因
  - **SHAP分析**: P4とP3の寄与を統合して分析
  - **目的**: 高評価を増やすための施策を特定
  
- **P2・P1（低評価確率）への寄与**: 低評価（2・1）を減らす要因
  - **SHAP分析**: P2とP1の寄与を統合して分析
  - **目的**: 低評価を減らすための施策を特定（**教師の最重要課題**）

### 3. **実装のイメージ**

```python
# 4点を増やす要因のSHAP分析
shap_p4 = run_shap_analysis(predict_p4, texts, "P4（4点確率）", output_dir)
# → 4点評価を増やす要因を特定

# 2点を減らす要因のSHAP分析
shap_p2 = run_shap_analysis(predict_p2, texts, "P2（2点確率）", output_dir)
# → 2点評価を減らす要因を特定（教師の最重要課題）

# 高評価（4・3）を増やす要因のSHAP分析
# P4とP3の寄与を統合して分析
# → 高評価を増やす要因を特定

# 低評価（2・1）を減らす要因のSHAP分析
# P2とP1の寄与を統合して分析
# → 低評価を減らす要因を特定（教師の最重要課題）
```

**特に重要な分析**:
- **P4（4点確率）への寄与**: 4点を増やす要因 → 高評価を増やす施策
- **P2（2点確率）への寄与**: 2点を減らす要因 → 低評価を減らす施策（**教師の最重要課題**）
- **P4・P3（高評価確率）への寄与**: 高評価を増やす要因
- **P2・P1（低評価確率）への寄与**: 低評価を減らす要因（**教師の最重要課題**）

### 2. **順序性を構造的に保証**

- **CORAL型順序回帰**: 累積ロジット（p_ge2, p_ge3, p_ge4）から確率分布を復元
- **順序性の保証**: 1→2→3→4の順序を構造的に尊重
- **遠い誤りの抑制**: 1↔4の誤りを構造的に抑制

### 3. **期待値E[y]の計算による解釈性の向上**

- **期待値計算**: E[y] = 1×P1 + 2×P2 + 3×P3 + 4×P4
- **解釈性**: 確率分布から期待値を計算することで、より解釈可能な予測が可能

## 📝 予稿での記述方針

### 1. **研究の流れ**

```
第1段階: 単一タスクモデル
  → 各タスクを個別に学習（限界を発見）

第2段階: マルチタスクモデル
  → 感情スコアと授業評価スコアを同時予測
  → タスク間干渉による性能低下を発見
  → 評価スコアを連続値として扱う課題を発見
  → 2点がどのような要因があるかと、4点がどのような要因があるかを区別できない

第3段階: 順序回帰モデル（マルチタスク学習の改善版、本研究の提案）
  → マルチタスク学習の一種（感情スコア + 確率分布）
  → 順序性を考慮したモデリング（CORAL型順序回帰）
  → 確率分布（P1～P4）を直接予測
  → 2種類の要因分離を実現：
    1. 各評価段階を分ける要因（4, 3, 2, 1の分離）
    2. 高評価と低評価を分ける要因（4・3と2・1の分離）
  → 教師の視点：2点を減らす要因と4点を増やす要因を明確に特定
  → 平均3点の改善戦略を実現可能
  → **2点と4点のSHAP分析が可能**（`predict_p2`と`predict_p4`関数を使用）
```

### 2. **順序回帰モデルの意義（予稿での記述例）**

#### 問題提起
「従来のマルチタスク学習では、評価スコア（1～4）を連続値として扱うため、順序性が考慮されていない。また、高評価を上げる要因と低評価を下げる要因を区別することが困難であった。」

#### 提案手法
「これらの課題を解決するため、順序回帰（Ordinal Regression）を採用した。順序回帰により、評価スコアの順序性を構造的に保証し、確率分布（P1～P4）を直接予測することが可能になる。特に、以下の2種類の要因分離を実現できる：

1. **各評価段階を分ける要因（4, 3, 2, 1の分離）**: P4, P3, P2, P1への寄与を個別に分析することで、各評価段階での要因を詳細に特定できる。特に、**2点がどのような要因があるか**と**4点がどのような要因があるか**を明確に区別できる。

2. **高評価と低評価を分ける要因（4・3と2・1の分離）**: P4・P3とP2・P1への寄与を統合的に分析することで、高評価を増やす要因と低評価を減らす要因を分離できる。

これにより、教師の視点から、平均3点の改善戦略として、**2点を減らす要因**と**4点を増やす要因**を明確に特定できる。」

#### 実験結果
「順序回帰モデルにより、以下の2種類の要因分離を実現した：

1. **各評価段階を分ける要因（4, 3, 2, 1の分離）**: 
   - P4（4点確率）への寄与が高い要因を特定することで、4点を増やす施策を提案できる
   - P3（3点確率）への寄与が高い要因を特定することで、3点を増やす施策を提案できる
   - P2（2点確率）への寄与が高い要因を特定することで、2点を減らす施策を提案できる（**教師の最重要課題**）
   - P1（1点確率）への寄与が高い要因を特定することで、1点を減らす施策を提案できる

2. **高評価と低評価を分ける要因（4・3と2・1の分離）**:
   - P4・P3（高評価確率）への寄与が高い要因を特定することで、高評価を増やす施策を提案できる
   - P2・P1（低評価確率）への寄与が高い要因を特定することで、低評価を減らす施策を提案できる（**教師の最重要課題**）

これにより、教師の視点から、平均3点の改善戦略として、**2点を減らす要因**と**4点を増やす要因**を明確に特定し、実用的な改善提案が可能になった。」

### 3. **SHAP分析の深化（予稿での記述例）**

#### 従来のマルチタスク学習のSHAP分析
- 感情スコアへの寄与
- 授業評価スコアへの寄与
- **限界**: 評価スコアが連続値のため、段階別の要因分析が困難
- **限界**: 2点がどのような要因があるかと、4点がどのような要因があるかを区別できない

#### 順序回帰モデルのSHAP分析

**各評価段階を分ける要因（4, 3, 2, 1の分離）**:
- **P4（4点確率）への寄与** ← 新規（4点を増やす要因）
  - **実装済み**: `predict_p4`関数を使用してSHAP分析が可能
  - **出力**: `word_importance_p4_production.csv`、`p4_top30_factors_production.png`
- **P3（3点確率）への寄与** ← 新規（3点を増やす要因）
  - **実装済み**: `predict_p3`関数を使用してSHAP分析が可能
- **P2（2点確率）への寄与** ← 新規（2点を減らす要因、**教師の最重要課題**）
  - **実装済み**: `predict_p2`関数を使用してSHAP分析が可能
  - **出力**: `word_importance_p2_production.csv`、`p2_top30_factors_production.png`
- **P1（1点確率）への寄与** ← 新規（1点を減らす要因）
  - **実装済み**: `predict_p1`関数を使用してSHAP分析が可能

**高評価と低評価を分ける要因（4・3と2・1の分離）**:
- **P4・P3（高評価確率）への寄与** ← 新規（高評価を増やす要因）
- **P2・P1（低評価確率）への寄与** ← 新規（低評価を減らす要因、**教師の最重要課題**）

**その他の分析**:
- 感情スコアへの寄与
- 授業評価スコアへの寄与
- **期待値E[y]への寄与** ← 新規

**意義**: 
- 各評価段階（4, 3, 2, 1）での要因を詳細に分析可能
- 特に、**2点がどのような要因があるか**と**4点がどのような要因があるか**を区別可能
- **高評価（4・3）と低評価（2・1）の要因を分離**できる
- 教師の視点から、**2点を減らす要因**と**4点を増やす要因**を明確に特定可能

### 4. **実用的な改善提案（予稿での記述例）**

#### 教師の視点：平均3点の改善戦略

**問題意識**: 授業評価スコアの平均は約3点である。教師側からしたら、**2点のものを減らして、4点のものを増やしたい**。

#### 4点を増やす施策（高評価を増やす）
- **P4（4点確率）への寄与が高い要因**を特定
  - SHAP分析により、4点評価を増やす要因を明確化
  - これらの要因を重視した授業改善により、4点評価を増やす
- **P4・P3（高評価確率）への寄与が高い要因**を特定
  - 高評価（4・3）を増やす要因を統合的に分析
  - これらの要因を重視した授業改善により、高評価を増やす

#### 2点を減らす施策（低評価を減らす、**教師の最重要課題**）
- **P2（2点確率）への寄与が高い要因**を特定
  - SHAP分析により、2点評価を減らす要因を明確化
  - これらの要因を回避・改善することで、2点評価を減らす（**教師の最重要課題**）
- **P2・P1（低評価確率）への寄与が高い要因**を特定
  - 低評価（2・1）を減らす要因を統合的に分析
  - これらの要因を回避・改善することで、低評価を減らす（**教師の最重要課題**）

#### 3点を増やす施策（中評価を増やす）
- **P3（3点確率）への寄与が高い要因**を特定
  - 3点評価を増やす要因を分析
  - これらの要因を重視した授業改善により、3点評価を増やす

#### 1点を減らす施策（最低評価を減らす）
- **P1（1点確率）への寄与が高い要因**を特定
  - 1点評価を減らす要因を分析
  - これらの要因を回避・改善することで、1点評価を減らす

## 🔬 方法論的貢献（予稿での記述例）

### 従来のマルチタスク学習の限界
1. **タスク間干渉**: 感情分析精度が77.0% → 72.5%（-4.5%低下）
2. **モデリングの課題**: 評価スコアを連続値として扱うため、順序性が考慮されていない
3. **要因分析の限界**: 高評価と低評価の要因を区別することが困難

### 順序回帰モデルの貢献
1. **マルチタスク学習の改善版**: 従来のマルチタスク学習の課題を解決
   - 従来: 感情スコア（回帰） + 授業評価スコア（回帰）
   - 改善: 感情スコア（回帰） + 確率分布（順序回帰）
2. **順序性の保証**: CORAL型順序回帰により、1→2→3→4の順序を構造的に尊重
3. **確率分布の直接予測**: P1～P4の分布を直接学習することで、より適切なモデリング
4. **要因分析の深化**: 各評価段階（P1～P4）での要因を詳細に分析可能
5. **2種類の要因分離**:
   - **各評価段階を分ける要因（4, 3, 2, 1の分離）**: P4, P3, P2, P1への寄与を個別に分析
   - **高評価と低評価を分ける要因（4・3と2・1の分離）**: P4・P3とP2・P1への寄与を統合的に分析
6. **教師の視点に立った要因分析**: 
   - **2点がどのような要因があるか**を明確に特定（2点を減らす要因）
   - **4点がどのような要因があるか**を明確に特定（4点を増やす要因）
   - **2点と4点のSHAP分析が実装済み**（`predict_p2`と`predict_p4`関数を使用）
   - 平均3点の改善戦略を実現可能

## 📌 予稿執筆時の注意事項

### 文体
- **文語体「である」調**を使用（口語体は厳禁）
- **客観的で簡潔な表現**を心がける
- **主語を明確に**する（「本研究では」「順序回帰モデルにより」など）

### 数値の記述
- **統計的有意性を必ず明記**（p値、信頼区間など）
- **単位を必ず記述**する（例：3.459点、0.216標準偏差）
- **範囲を示す場合は明確に**（例：3.330～3.600点）

### 図表の扱い
- **図のキャプションは図の下**に配置
- **表のキャプションは表の上**に配置
- **解像度は300dpi以上**（印刷品質）
- **本文中で必ず参照**する（「図1に示すように」「表1の通り」）

### 数式の扱い
- **重要な数式には必ず番号を付与**
- **変数は必ず定義**する
- **本文中で参照**する（「式(1)に示すように」）

### 参考文献の扱い
- **すべての主張に根拠（参考文献）を付与**
- **一次資料（原著論文）を優先**
- **最新の研究**を参照（可能な限り5年以内）

## ✅ 最終確認チェックリスト

- [ ] 従来のマルチタスク学習との違いが明確か
- [ ] 順序回帰モデルの目的（2種類の要因分離）が明確か
  - [ ] 各評価段階を分ける要因（4, 3, 2, 1の分離）が明確か
  - [ ] 高評価と低評価を分ける要因（4・3と2・1の分離）が明確か
- [ ] 教師の視点（平均3点の改善戦略）が明確か
  - [ ] 2点を減らす要因の分析が明確か
  - [ ] 4点を増やす要因の分析が明確か
  - [ ] 2点と4点のSHAP分析が実装済みであることが明記されているか
- [ ] 方法論的貢献が明確か
- [ ] 実用的な改善提案が明確か
- [ ] 文体が「である」調で統一されているか
- [ ] 数値に統計的有意性が明記されているか
- [ ] 図表にキャプションがあるか
- [ ] 数式の変数が定義されているか
- [ ] すべての主張に根拠（参考文献）があるか
