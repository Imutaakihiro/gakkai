### 研究結果サマリ（現状）

- ベースモデル: `koheiduck/bert-japanese-finetuned-sentiment`
- 単一タスクモデル1（自由記述→感情スコア）
  - 训练・評価: `00_スクリプト/evaluate_sentiment_model.py`
  - 結果: `03_分析結果/モデル評価` 配下のJSON、および `感情分類結果_*.csv`
- 単一タスクモデル2（自由記述→授業評価スコア）
  - 训练: `00_スクリプト/train_score_model.py`
  - 結果指標: RMSE, MAE, R², 相関係数
  - 結果保存: `02_モデル/単一タスクモデル2_評価スコア/`
- マルチタスクモデル（自由記述→感情＋評価スコア）
  - 训练: `00_スクリプト/train_multitask_model.py`
  - 比較: `00_スクリプト/compare_models.py`, `00_スクリプト/compare_multitask_single_model.py`
  - モデル保存: `02_モデル/マルチタスクモデル/`
  - 代表モデル: `02_モデル/マルチタスクモデル/best_model.pth`

- SHAP分析（単一・マルチタスク）
  - 単一タスク感情: `00_スクリプト/analyze_sentiment_shap.py`, `analyze_sentiment_shap_5000.py`
  - マルチタスク（本番）: `00_スクリプト/analyze_multitask_shap_production.py`
  - 可視化まとめ: `03_分析結果/マルチタスクSHAP分析_本番用/`（各PNG, CSV, JSON）
  - 追加分析: `00_スクリプト/analyze_class_level_multitask_shap.py`

- 相関・分布・要因分析（抜粋）
  - 相関: `00_スクリプト/analyze_correlation.py`（授業集約データも対応）
  - 感情分布: `00_スクリプト/analyze_sentiment_distribution.py`
  - 要因: `00_スクリプト/analyze_specialized_factors.py`, `postprocess_word_importance.py`

### 主な成果物（出力）

- モデル保存
  - `02_モデル/マルチタスクモデル/`（例: `best_model.pth`）
  - `02_モデル/単一タスクモデル2_評価スコア/`
  - `02_モデル/授業レベルマルチタスクモデル/`

- 分析結果（抜粋）
  - モデル比較: `03_分析結果/モデル比較/`
  - SHAP: `03_分析結果/SHAP分析/`, `03_分析結果/マルチタスクSHAP分析_本番用/`
  - マルチタスク学習の可視化: `03_分析結果/マルチタスク学習/`
  - 授業集約相関: `03_分析結果/相関分析_授業集約データ.png`, `.md`, `.json`

- 代表的な図（例）
  - `03_分析結果/マルチタスクSHAP分析_本番用/sentiment_top30_factors_production.png`
  - `03_分析結果/マルチタスクSHAP分析_本番用/factor_comparison_scatter_production.png`
  - `03_分析結果/マルチタスクSHAP分析_本番用/course_top100_factors_production.png`

### データセット

- 元データ
  - `01_データ/元データ/(CSV用)前処理後データ.csv`
  - `01_データ/元データ/(CSV用)前処理後データ_free_text_only.csv`

- 単一タスク（感情）
  - `01_データ/自由記述→感情スコア/finetuning_dataset_*.csv`
  - `01_データ/自由記述→感情スコア/finetuning_train_*.csv`
  - `01_データ/自由記述→感情スコア/finetuning_val_*.csv`

- マルチタスク用
  - `01_データ/マルチタスク用データ/マルチタスク学習用データセット_*.csv`
  - 授業集約: `01_データ/マルチタスク用データ/授業集約データセット_*.csv`

- 出力結合例
  - `感情分類結果_前処理データ結合_20250729_154855.csv`
  - `感情分類結果_4モデル比較_20250722_165252.csv`

### 実行・環境関連

- 依存関係/環境確認
  - `99_その他/requirements.txt`
  - `00_スクリプト/install_requirements.py`, `check_pytorch_version.py`, `check_gpu.py`, `gpu_smoke_test.py`, `diagnose_cuda.py`, `test_directml_setup.py`

- 実行手順ドキュメント
  - `04_Docs/README_実行手順.md`

### ドキュメント（抜粋）

- 研究計画・考察
  - `04_Docs/卒論完成までの実行計画.md`
  - `04_Docs/研究の重要な考察.md`
  - `04_Docs/マルチタスク学習SHAP分析_結論.md`
  - `04_Docs/論文構成案_*.md`

- 本件の新規方針（授業単位×順序回帰×LLP）
  - `04_Docs/授業単位マルチタスク_順序回帰LLP計画.md`

### 次のアクション（要約）

- 授業単位のマルチタスク学習に、順序回帰ヘッド（2–4）とLLP損失を導入
- 回答者数による授業重み付け、授業単位分割、単調性ペナルティを実装
- 評価指標（KL/EMD/期待値MAE/QWK）のログ化と可視化

### 授業単位マルチタスク（最終採用）

- 概要
  - 自由記述から感情＋授業評価（2–4の順序）を同時学習
  - 授業単位の分布（割合）と回答者数を用いたLLPで学習安定化
  - 1は除外し、順序回帰（y≥3, y≥4）を採用
- 使用スクリプト
  - 学習: `00_スクリプト/train_class_level_multitask.py`
  - 解析/可視化: `00_スクリプト/analyze_class_level_multitask_shap.py`
  - 追加解析: `00_スクリプト/visualize_multitask_significance.py`
- 入出力
  - 入力データ（授業集約）: `01_データ/マルチタスク用データ/授業集約データセット_*.csv`
  - モデル保存: `02_モデル/授業レベルマルチタスクモデル/`
  - 分析結果: `03_分析結果/授業レベルマルチタスク学習/`
- 主要指標（授業レベル）
  - 分布一致: KL/JS、EMD、L1/L2差
  - 期待値精度: |E_q[y]−E_p̄[y]|、Spearman相関
  - クラス一致: 最多カテゴリ一致率、Within-1 accuracy（参考）
- 参考ドキュメント
  - 設計方針: `04_Docs/授業単位マルチタスク_順序回帰LLP計画.md`
