---
alwaysApply: true
---

#　実験ルール
- ｐｃのＧＰＵは必ず使用すること
- 使用できない場合は、実行しない、なんとしてでも使用して進めれるように考察を繰り返すこと
- 実行は、僕がするのであなたは実行のコードだ毛教えて！
- **エラー対応時は必ず3回見直すこと**: エラーが発生した場合、根本原因を特定するために最低3回は異なる角度から確認・検証を行うこと
  - 1回目: エラーメッセージとスタックトレースを詳細に確認
  - 2回目: 関連するコード全体を確認し、根本原因を特定
  - 3回目: 修正後のコードが本当に正しいか、他の箇所への影響がないか確認
    

# 順序回帰実験ルール

## 目的
マルチタスク学習の上位互換である順序回帰モデルで卒論の実験をすべて完了させる。

## 現状
- ✅ 順序回帰モデル学習完了: `class_level_ordinal_llp_20251030_162353.pth` (Test weighted KL: 0.1196)
- ✅ SHAP分析スクリプト実装済み: `analyze_ordinal_shap_production.py`
- ✅ SHAP分析スクリプト修正完了: 形状エラー対応、GPU優先設定、エラーハンドリング強化
- ✅ テスト用スクリプト作成: `test_ordinal_shap_small.py` (10件サンプル)
- ✅ 比較用スクリプト作成: `analyze_ordinal_shap_comparison.py` (感情スコア・授業評価スコアのみ)
- ⏳ SHAP分析実行: テスト実行待ち
- ❌ 結果分析: 未完了

## 記録方法
- 会話記録: `Chat/順序回帰実験_会話記録_202501.md`
- ドキュメント: `04_Docs/` 配下に保存
- 分析結果: `03_分析結果/` 配下に保存

## 次のステップ
1. ✅ 順序回帰SHAP分析の実行計画を立てる（完了）
2. ⏳ **テスト実行**: `test_ordinal_shap_small.py` で動作確認（10件、約5-10分）
3. ⏳ **本番実行**: `analyze_ordinal_shap_production.py` でSHAP分析実行（感情スコア・授業評価スコアのみ、約1時間）
4. ⏳ 結果分析と可視化
5. ⏳ マルチタスクモデルとの比較（同じ授業単位データで比較可能）
6. ⏳ 卒論用の実験結果まとめ

## 実行コマンド（ユーザーが実行）
### テスト実行
```powershell
# 仮想環境有効化
.\venv_ordinal_shap\Scripts\Activate.ps1

# テスト実行（10件、約5-10分）
cd 00_スクリプト
python test_ordinal_shap_small.py
```

### 本番実行
```powershell
# 仮想環境有効化
.\venv_ordinal_shap\Scripts\Activate.ps1

# 本番実行（1,000件、約1時間）
cd 00_スクリプト
python analyze_ordinal_shap_production.py
```

## 注意事項
- **GPU必須**: CUDA → DirectML → CPU の順で自動選択
- **比較対象**: マルチタスク学習も授業単位（class-level）で実行済み → 直接比較可能
- **出力先**: `03_分析結果/順序回帰SHAP分析_本番用/`
